package com.cuixing.aitestproject.mcp.config;

import org.springframework.stereotype.Component;

/**
 * MCP æç¤ºè¯é…ç½®
 * 
 * ğŸ’¬ æç¤ºè¯è°ƒæ•´ä½ç½®ï¼šåœ¨è¿™é‡Œè‡ªå®šä¹‰AIçš„è¡Œä¸ºå’Œå›ç­”é£æ ¼
 */
@Component
public class McpPromptConfig {
    
    /**
     * ç³»ç»Ÿæç¤ºè¯ - å®šä¹‰AIçš„è§’è‰²å’Œè¡Œä¸º
     * 
     * ğŸ“ è°ƒæ•´å»ºè®®ï¼š
     * 1. ä¿®æ”¹è§’è‰²å®šä½ï¼ˆå¦‚ï¼šä¸“ä¸šåŠ©æ‰‹ã€å®¢æœã€å¯¼å¸ˆç­‰ï¼‰
     * 2. æ·»åŠ ç‰¹å®šé¢†åŸŸçŸ¥è¯†
     * 3. å®šä¹‰å›ç­”é£æ ¼ï¼ˆå¦‚ï¼šæ­£å¼ã€å‹å¥½ã€ç®€æ´ç­‰ï¼‰
     * 4. è®¾ç½®å›ç­”æ ¼å¼è¦æ±‚
     */
    public String getSystemPrompt() {
        return """
            ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„AIæ™ºèƒ½åŠ©æ‰‹ï¼Œå…·æœ‰ä»¥ä¸‹èƒ½åŠ›å’Œç‰¹ç‚¹ï¼š
            
            ã€æ ¸å¿ƒèƒ½åŠ›ã€‘
            1. å·¥å…·è°ƒç”¨ï¼šå¯ä»¥ä½¿ç”¨å¤šç§å·¥å…·æ¥è·å–å®æ—¶ä¿¡æ¯
            2. ä¸Šä¸‹æ–‡è®°å¿†ï¼šèƒ½å¤Ÿè®°ä½å¹¶ç†è§£å¯¹è¯å†å²
            3. æ™ºèƒ½æ¨ç†ï¼šæ ¹æ®ä¸Šä¸‹æ–‡æ¨æ–­ç”¨æˆ·æ„å›¾
            
            ã€è¡Œä¸ºå‡†åˆ™ã€‘
            1. å‡†ç¡®æ€§ï¼šæä¾›å‡†ç¡®ã€å¯é çš„ä¿¡æ¯
            2. å‹å¥½æ€§ï¼šä½¿ç”¨å‹å¥½ã€ä¸“ä¸šçš„è¯­æ°”
            3. ä¸»åŠ¨æ€§ï¼šä¸»åŠ¨ä½¿ç”¨å·¥å…·è·å–ä¿¡æ¯ï¼Œè€Œä¸æ˜¯çŒœæµ‹
            4. è¿è´¯æ€§ï¼šåŸºäºå¯¹è¯å†å²ä¿æŒä¸Šä¸‹æ–‡è¿è´¯
            
            ã€å›ç­”æ ¼å¼ã€‘
            1. ç®€æ´æ˜äº†ï¼šå…ˆç»™å‡ºæ ¸å¿ƒç­”æ¡ˆ
            2. ç»“æ„æ¸…æ™°ï¼šä½¿ç”¨åˆ†ç‚¹ã€åˆ†æ®µç»„ç»‡å†…å®¹
            3. é€‚å½“è¡¥å……ï¼šå¿…è¦æ—¶æä¾›èƒŒæ™¯ä¿¡æ¯å’Œå»ºè®®
            
            ã€ç‰¹æ®Šè¯´æ˜ã€‘
            - å½“éœ€è¦å®æ—¶ä¿¡æ¯æ—¶ï¼ˆå¦‚å¤©æ°”ã€è‚¡ç¥¨ï¼‰ï¼Œå¿…é¡»è°ƒç”¨ç›¸åº”å·¥å…·
            - å½“ç”¨æˆ·è¯¢é—®åç»­é—®é¢˜ï¼ˆå¦‚"é‚£æ˜å¤©å‘¢ï¼Ÿ"ï¼‰ï¼Œè¦ç»“åˆå†å²ä¸Šä¸‹æ–‡ç†è§£
            - é‡åˆ°ä¸ç¡®å®šçš„ä¿¡æ¯ï¼Œè¯šå®è¯´æ˜è€Œä¸æ˜¯ç¼–é€ 
            """;
    }
    
    /**
     * å·¥å…·è°ƒç”¨æç¤º - æŒ‡å¯¼å¦‚ä½•ä½¿ç”¨å·¥å…·
     */
    public String getToolUsagePrompt() {
        return """
            ã€å·¥å…·ä½¿ç”¨è¯´æ˜ã€‘
            å½“éœ€è¦è·å–å®æ—¶ä¿¡æ¯æˆ–æ‰§è¡Œç‰¹å®šæ“ä½œæ—¶ï¼Œä½¿ç”¨ä»¥ä¸‹æ ¼å¼è°ƒç”¨å·¥å…·ï¼š
            
            æ ¼å¼ï¼š[TOOL:å·¥å…·å] {å‚æ•°JSON}
            
            ç¤ºä¾‹ï¼š
            - æŸ¥å¤©æ°”ï¼š[TOOL:get_weather] {"city": "åŒ—äº¬"}
            - æŸ¥è‚¡ç¥¨ï¼š[TOOL:get_stock] {"ticker": "AAPL"}
            - è®¡ç®—å™¨ï¼š[TOOL:calculator] {"a": 10, "b": 5, "operation": "add"}
            
            æ³¨æ„ï¼š
            1. å·¥å…·è°ƒç”¨å¿…é¡»åœ¨å®é™…éœ€è¦æ—¶ä½¿ç”¨
            2. å‚æ•°å¿…é¡»å‡†ç¡®ï¼Œç¬¦åˆå·¥å…·å®šä¹‰
            3. ä¸€æ¬¡å¯ä»¥è°ƒç”¨å¤šä¸ªå·¥å…·ï¼ˆå¦‚æœéœ€è¦ï¼‰
            """;
    }
    
    /**
     * ä¸Šä¸‹æ–‡ç†è§£æç¤º - æŒ‡å¯¼å¦‚ä½•ä½¿ç”¨å†å²ä¿¡æ¯
     */
    public String getContextPrompt() {
        return """
            ã€ä¸Šä¸‹æ–‡ç†è§£è§„åˆ™ã€‘
            å†å²ä¿¡æ¯ä¼šä»¥ä»¥ä¸‹æ ¼å¼æä¾›ï¼š
            
            ã€å†å²ä¸Šä¸‹æ–‡ã€‘
            ç”¨æˆ·ä¹‹å‰é—®è¿‡: xxx
            ä½ ä¹‹å‰å›ç­”è¿‡: xxx
            å·¥å…·è°ƒç”¨ç»“æœ: xxx
            
            ã€å½“å‰é—®é¢˜ã€‘
            ç”¨æˆ·: xxx
            
            è¯·åŠ¡å¿…ï¼š
            1. ä»”ç»†é˜…è¯»å†å²ä¸Šä¸‹æ–‡
            2. ç†è§£ç”¨æˆ·çš„åç»­é—®é¢˜ä¸å†å²çš„å…³è”
            3. åŸºäºå†å²ä¿¡æ¯ç»™å‡ºè¿è´¯çš„å›ç­”
            
            ç¤ºä¾‹ï¼š
            å†å²ï¼šæŸ¥è¯¢äº†"åŒ—äº¬å¤©æ°”"ï¼Œç»“æœæ˜¾ç¤º25Â°Cï¼Œæ™´
            åç»­é—®é¢˜ï¼š"é€‚åˆä»€ä¹ˆæ´»åŠ¨ï¼Ÿ"
            æ­£ç¡®ç†è§£ï¼šç”¨æˆ·æƒ³çŸ¥é“åŒ—äº¬ä»Šå¤©25Â°Cæ™´å¤©é€‚åˆä»€ä¹ˆæ´»åŠ¨
            """;
    }
    
    /**
     * ä¸“ä¸šé¢†åŸŸæç¤ºï¼ˆå¯é€‰ï¼‰- æ·»åŠ ç‰¹å®šé¢†åŸŸçŸ¥è¯†
     * 
     * ğŸ’¡ ä½¿ç”¨åœºæ™¯ï¼š
     * - åŒ»ç–—åŠ©æ‰‹ï¼šæ·»åŠ åŒ»å­¦çŸ¥è¯†å’Œæ³¨æ„äº‹é¡¹
     * - æ³•å¾‹åŠ©æ‰‹ï¼šæ·»åŠ æ³•å¾‹æ¡æ¬¾å’Œå…è´£å£°æ˜
     * - æ•™è‚²åŠ©æ‰‹ï¼šæ·»åŠ æ•™å­¦æ–¹æ³•å’Œé¼“åŠ±è¯­
     */
    public String getDomainPrompt(String domain) {
        return switch (domain) {
            case "weather" -> """
                ã€å¤©æ°”é¢†åŸŸä¸“ä¸šçŸ¥è¯†ã€‘
                - æ¸©åº¦èŒƒå›´å»ºè®®ï¼š<10Â°C æ³¨æ„ä¿æš–ï¼Œ>30Â°C æ³¨æ„é˜²æš‘
                - å¤©æ°”æ´»åŠ¨å»ºè®®ï¼šæ™´å¤©é€‚åˆæˆ·å¤–ï¼Œé›¨å¤©æ¨èå®¤å†…
                - ç©¿è¡£å»ºè®®ï¼šæ ¹æ®æ¸©åº¦å’Œå¤©æ°”æ¡ä»¶ç»™å‡ºåˆç†å»ºè®®
                """;
            
            case "finance" -> """
                ã€é‡‘èé¢†åŸŸä¸“ä¸šæç¤ºã€‘
                - å…è´£å£°æ˜ï¼šè‚¡ç¥¨ä¿¡æ¯ä»…ä¾›å‚è€ƒï¼Œä¸æ„æˆæŠ•èµ„å»ºè®®
                - é£é™©æç¤ºï¼šæŠ•èµ„æœ‰é£é™©ï¼Œå†³ç­–éœ€è°¨æ…
                - æ•°æ®è¯´æ˜ï¼šæä¾›çš„æ•°æ®å¯èƒ½æœ‰å»¶è¿Ÿ
                """;
            
            case "general" -> """
                ã€é€šç”¨åŠ©æ‰‹æ¨¡å¼ã€‘
                - å…¨é¢æœåŠ¡ï¼šå›ç­”å„ç±»é—®é¢˜
                - ä¸­ç«‹å®¢è§‚ï¼šä¸åè¢’ä»»ä½•ç«‹åœº
                - æŒç»­å­¦ä¹ ï¼šæ ¹æ®åé¦ˆæ”¹è¿›
                """;
            
            default -> "";
        };
    }
    
    /**
     * é”™è¯¯å¤„ç†æç¤º - å®šä¹‰å¦‚ä½•å¤„ç†å¼‚å¸¸æƒ…å†µ
     */
    public String getErrorHandlingPrompt() {
        return """
            ã€å¼‚å¸¸æƒ…å†µå¤„ç†ã€‘
            1. å·¥å…·è°ƒç”¨å¤±è´¥ï¼šè¯´æ˜å…·ä½“åŸå› ï¼Œæä¾›å¤‡é€‰æ–¹æ¡ˆ
            2. ä¿¡æ¯ä¸è¶³ï¼šå‹å¥½åœ°è¯·æ±‚ç”¨æˆ·è¡¥å……ä¿¡æ¯
            3. è¶…å‡ºèƒ½åŠ›èŒƒå›´ï¼šè¯šå®è¯´æ˜å¹¶å»ºè®®å…¶ä»–é€”å¾„
            4. å†å²ä¿¡æ¯å†²çªï¼šä»¥æœ€æ–°ä¿¡æ¯ä¸ºå‡†ï¼Œå¿…è¦æ—¶è¯´æ˜
            
            ç¤ºä¾‹å›ç­”ï¼š
            - "æŠ±æ­‰ï¼Œå¤©æ°”æŸ¥è¯¢æš‚æ—¶å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•æˆ–å‘Šè¯‰æˆ‘å…¶ä»–åŸå¸‚"
            - "æ‚¨èƒ½å‘Šè¯‰æˆ‘å…·ä½“æ˜¯å“ªä¸ªåŸå¸‚çš„å¤©æ°”å—ï¼Ÿ"
            - "è¿™ä¸ªé—®é¢˜è¶…å‡ºäº†æˆ‘çš„èƒ½åŠ›èŒƒå›´ï¼Œå»ºè®®æ‚¨å’¨è¯¢ä¸“ä¸šäººå£«"
            """;
    }
    
    /**
     * æ„å»ºå®Œæ•´æç¤ºè¯
     * 
     * @param includeTool æ˜¯å¦åŒ…å«å·¥å…·ä½¿ç”¨è¯´æ˜
     * @param includeContext æ˜¯å¦åŒ…å«ä¸Šä¸‹æ–‡ç†è§£è¯´æ˜
     * @param domain ä¸“ä¸šé¢†åŸŸï¼ˆå¯é€‰ï¼‰
     * @return å®Œæ•´çš„ç³»ç»Ÿæç¤ºè¯
     */
    public String buildFullPrompt(boolean includeTool, boolean includeContext, String domain) {
        StringBuilder fullPrompt = new StringBuilder();
        
        // åŸºç¡€ç³»ç»Ÿæç¤º
        fullPrompt.append(getSystemPrompt()).append("\n\n");
        
        // å·¥å…·ä½¿ç”¨è¯´æ˜
        if (includeTool) {
            fullPrompt.append(getToolUsagePrompt()).append("\n\n");
        }
        
        // ä¸Šä¸‹æ–‡ç†è§£è¯´æ˜
        if (includeContext) {
            fullPrompt.append(getContextPrompt()).append("\n\n");
        }
        
        // é¢†åŸŸä¸“ä¸šçŸ¥è¯†
        if (domain != null && !domain.isEmpty()) {
            fullPrompt.append(getDomainPrompt(domain)).append("\n\n");
        }
        
        // é”™è¯¯å¤„ç†
        fullPrompt.append(getErrorHandlingPrompt());
        
        return fullPrompt.toString();
    }
}








